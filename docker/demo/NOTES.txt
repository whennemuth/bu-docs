1) Download the docker build context:

sudo rm -rf /opt/dockerdemo && \
sudo mkdir -p /opt/dockerdemo && \
sudo chown ec2-user /opt/dockerdemo && \
cd /opt/dockerdemo && \
git init && \
git remote add github https://github.com/whennemuth/bu-docs.git && \
git config core.sparsecheckout true && \
echo docker/demo/ >> .git/info/sparse-checkout && \
git pull github master && \
cd docker/demo && ls -la && \

2) Add a default page for apache in a directory we create to be mounted to the docker container

mkdir www && \
echo "Hello World!" > index.html

3) Declare the value used to tag the docker image with once created
ECR_REGISTRY_URL=730096353738.dkr.ecr.us-east-1.amazonaws.com && \
REGISTRY_REPO_NAME=hello-world && \
DOCKER_TAG_VERSION=docker-demo.version.0.0.1 && \
ECR_REPO_URL="${ECR_REGISTRY_URL}/${REGISTRY_REPO_NAME}" && \
DOCKER_TAG="${ECR_REPO_URL}:${DOCKER_TAG_VERSION}" && \
echo $DOCKER_TAG

4) Build the docker image:
docker build \
  --build-arg MY_BUILD_ARG=oranges \ 
  -t $DOCKER_TAG \
  .

5) Run a container from the docker image:
docker run \
  -d \
  -p 8080:80 \
  -e MY_RUN_ENV=bannanas \
  -v $(pwd)/www:/var/www \
  --name helloworld \
  $DOCKER_TAG

6) Push the docker image to the docker registry:
eval $(aws ecr get-login --profile ecr.access) && \
docker push $DOCKER_TAG
